---
description: 执行计划前须参考 docs 下所有开发者文档；生成代码须写注释；变量与方法须注明作用；修改代码时同步更新相关开发文档；BUG 修复须记录到 BUG_LOG
alwaysApply: true
---

# 代码与文档规范

## 0. 执行计划前须参考 docs 下所有开发者文档

进行任务规划、功能设计或功能开发前，**必须先阅读并参考 `docs/` 文件夹下的所有开发者文档**，包括但不限于：

- `docs/DEVELOPER_GUIDE.md` — 架构、模块职责、数据流、扩展入口、配置项、排障
- `docs/CODE_INDEX.md` — 代码索引与文件结构
- `docs/NOMENCLATURE.md` — 菜单、UI、功能模块的**项目内部称呼**，涉及名词时须参考
- `docs/BUG_LOG.md` — BUG 修复记录，**执行 coding 计划时必读**，避免出现同类问题

据此规划实现路径，避免与现有架构冲突、重复踩坑。

## 0.1 BUG 修复须记录到 BUG_LOG

每次修复报错或 BUG 后，**必须**在 `docs/BUG_LOG.md` 中新增一条记录，包含：

- **现象**：报错信息或异常表现
- **原因**：根因分析（为何会出现）
- **修复**：具体修改内容
- **预防**：后续如何避免同类问题

执行 coding 计划时参考 BUG_LOG，在实现前检查是否有可借鉴或需规避的条目。

## 1. 生成代码时必须写注释

每次生成或修改代码时：

- **文件头**：用 1–3 行注释说明脚本/模块职责
- **复杂逻辑**：在分支、循环、重要算法处加行内或块注释
- **导出变量/公开 API**：用 `#` 说明用途，必要时说明单位或取值范围

## 1.1 变量与方法须注明作用

编辑变量或方法时，必须写明其作用：

- **变量**：在声明处用 `#` 行内注释说明该变量的作用；`@export` 变量须说明用途、单位或取值范围
- **方法/函数**：在函数定义前用 1–2 行注释说明该方法的作用、参数含义及返回值含义（若非常规）

## 2. 同步更新开发文档

当新增、修改或删除功能时，必须同步更新 `docs/` 下相关开发文档：

- **涉及模块职责、数据流、扩展入口**：更新 `docs/DEVELOPER_GUIDE.md` 对应章节
- **新增敌人/升级/地形/UI**：在「核心模块职责」或「常见扩展入口」中补充说明
- **新增配置项**：在「关键配置项」中补充
- **发现或解决典型问题**：在「常见问题与排障」中补充
- **新增或移除脚本/场景**：同步更新 `docs/CODE_INDEX.md`（若有）
- **专业名词新增或改动**：同步更新 `docs/NOMENCLATURE.md`（见该文件「维护规则」）
- **修复报错或 BUG**：在 `docs/BUG_LOG.md` 中新增记录（现象、原因、修复、预防）

更新原则：保持文档与实现一致，便于后续维护与协作。
